<div class="container mt-4">
  <div class="card shadow rounded p-4">
    <h4 class="mb-4"><i class="fas fa-plus-circle text-primary"></i> إضافة تصنيف فرعي جديد</h4>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="mb-3">
        <label for="name" class="form-label">اسم التصنيف الفرعي</label>
        <input type="text" class="form-control" id="name" formControlName="name" required 
               placeholder="أدخل اسم التصنيف الفرعي" />
        <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="text-danger">
          <small *ngIf="form.get('name')?.errors?.['required']">اسم التصنيف مطلوب</small>
          <small *ngIf="form.get('name')?.errors?.['minlength']">اسم التصنيف يجب أن يكون أكثر من حرفين</small>
        </div>
      </div>

      <mat-form-field class="w-100" appearance="outline">
        <mat-label>اختر القسم الرئيسي</mat-label>
        <mat-select formControlName="category_id" required>
          <mat-option value="">-- اختر القسم الرئيسي --</mat-option>
          <mat-option *ngFor="let cat of categories; trackBy: trackByCategory" [value]="cat.id">
            {{ cat.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('category_id')?.invalid && form.get('category_id')?.touched">
          القسم الرئيسي مطلوب
        </mat-error>
      </mat-form-field> 

      <div class="mb-3">
        <label class="form-label">اختر صورة:</label>
        <input type="file" class="form-control" (change)="onFileChange($event)" accept="image/*" required />
        <small class="text-muted">يُفضل أن تكون الصورة بصيغة JPG أو PNG</small>
      </div>

      <div class="mb-3">
        <button class="btn btn-success" type="submit" [disabled]="form.invalid || !imageFile">
          <i class="fas fa-upload me-2"></i> إضافة
        </button>
        <button type="button" class="btn btn-secondary ms-2" (click)="resetForm()">
          <i class="fas fa-times me-2"></i> إلغاء
        </button>
      </div>
    </form>

    <div class="mt-3 p-3 bg-light rounded" *ngIf="categories.length === 0">
      <p class="text-warning mb-0">
        <i class="fas fa-exclamation-triangle me-2"></i>
        لا توجد أقسام رئيسية متاحة. تأكد من إضافة أقسام رئيسية أولاً.
      </p>
    </div>
  </div>
</div>
