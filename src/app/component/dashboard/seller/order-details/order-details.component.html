<div class="container mx-auto p-4">
    <button (click)="goBack()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded mb-4">
    &larr; Back to Orders
  </button>

    <div *ngIf="isLoading" class="text-center py-4">
        <p>Loading order details...</p>
    </div>

    <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ error }}
    </div>

    <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        {{ successMessage }}
    </div>

    <div *ngIf="order" class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="border-b px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold">Order: {{ order.slug }}</h1>

            <div class="flex items-center space-x-2">
                <span class="text-sm font-medium">Status:</span>
                <select [(ngModel)]="newStatus" (change)="statusChanged()" class="shadow border rounded py-1 px-2 text-gray-700 text-sm focus:outline-none focus:shadow-outline">
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
          <option value="cancelled">Cancelled</option>
        </select>

                <button *ngIf="statusUpdated" (click)="updateOrderStatus()" [disabled]="isUpdating" class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm">
          {{ isUpdating ? 'Updating...' : 'Save' }}
        </button>

                <button (click)="openDeleteConfirmModal()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm ml-3">
          Delete Order
        </button>
            </div>
        </div>

        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h2 class="text-lg font-semibold mb-2">Customer Information</h2>
                    <div class="bg-gray-50 p-4 rounded">
                        <p><span class="font-medium">Name:</span> {{ order.user.name }}</p>
                        <p><span class="font-medium">Email:</span> {{ order.user.email }}</p>
                        <p><span class="font-medium">Phone:</span> {{ order.user.phone }}</p>
                    </div>
                </div>

                <div>
                    <h2 class="text-lg font-semibold mb-2">Order Information</h2>
                    <div class="bg-gray-50 p-4 rounded">
                        <p><span class="font-medium">Order Date:</span> {{ order.created_at | date:'medium' }}</p>
                        <p><span class="font-medium">Last Updated:</span> {{ order.updated_at | date:'medium' }}</p>
                        <p><span class="font-medium">Total Price:</span> {{ order.total_price }}</p>
                        <p>
                            <span class="font-medium">Status:</span>
                            <span [ngClass]="{
                'bg-yellow-100 text-yellow-800': order.status === 'processing',
                'bg-blue-100 text-blue-800': order.status === 'shipped',
                'bg-green-100 text-green-800': order.status === 'delivered',
                'bg-red-100 text-red-800': order.status === 'cancelled'
              }" class="px-2 py-1 rounded-full text-xs font-medium ml-1">
                {{ order.status }}
              </span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <h2 class="text-lg font-semibold mb-2">Order Items</h2>
                <div class="bg-gray-50 rounded overflow-hidden">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr *ngFor="let item of order.order_items">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div *ngIf="item.order_item.images && item.order_item.images.length > 0" class="flex-shrink-0 h-10 w-10 mr-3">
                                            <img class="h-10 w-10 rounded object-cover" [src]="item.order_item.images[0].image_path" alt="Product image">
                                        </div>
                                        <div>
                                            <div class="font-medium text-gray-900">{{ item.order_item.name }}</div>
                                            <div class="text-sm text-gray-500">{{ item.order_item.description | slice:0:50 }}{{ item.order_item.description.length > 50 ? '...' : '' }}</div>
                                            <div class="text-xs text-gray-500 mt-1" *ngIf="item.order_item.colors && item.order_item.colors.length > 0">
                                                Colors:
                                                <span *ngFor="let color of item.order_item.colors; let last = last">
                          {{ color.color }}{{ !last ? ', ' : '' }}
                        </span>
                                            </div>
                                            <div class="text-xs text-gray-500" *ngIf="item.order_item.sizes && item.order_item.sizes.length > 0">
                                                Sizes:
                                                <span *ngFor="let size of item.order_item.sizes; let last = last">
                          {{ size.size }}{{ !last ? ', ' : '' }}
                        </span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {{ item.price }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {{ item.quantity }}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap font-medium">
                                    {{ (parseFloat(item.price) * item.quantity).toFixed(2) }}
                                </td>
                            </tr>
                        </tbody>
                        <tfoot class="bg-gray-50">
                            <tr>
                                <td colspan="3" class="px-6 py-4 text-right font-medium">Total:</td>
                                <td class="px-6 py-4 font-bold">{{ order.total_price }}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-10">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Delete Order</h2>
        <p class="mb-4">Are you sure you want to delete order <span class="font-semibold">{{ orderSlug }}</span>?</p>
        <p class="text-red-600 mb-4">This action cannot be undone.</p>

        <div class="flex justify-end space-x-2">
            <button (click)="closeDeleteConfirmModal()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded">
        Cancel
      </button>
            <button (click)="deleteOrder()" [disabled]="isDeleting" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
        {{ isDeleting ? 'Deleting...' : 'Delete' }}
      </button>
        </div>
    </div>
</div>
