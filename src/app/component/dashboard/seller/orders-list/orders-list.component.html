<div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Orders Management</h1>

    <div *ngIf="isLoading" class="text-center py-4">
        <p>Loading orders...</p>
    </div>

    <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ error }}
    </div>

    <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
        {{ successMessage }}
    </div>

    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let order of orders">
                    <td class="px-6 py-4 whitespace-nowrap">{{ order.slug }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ order.user.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ order.total_price }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span [ngClass]="{
              'bg-yellow-100 text-yellow-800': order.status === 'processing',
              'bg-blue-100 text-blue-800': order.status === 'shipped',
              'bg-green-100 text-green-800': order.status === 'delivered',
              'bg-red-100 text-red-800': order.status === 'cancelled'
            }" class="px-2 py-1 rounded-full text-xs font-medium">
              {{ order.status }}
            </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ order.created_at | date:'medium' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap flex space-x-2">
                        <button [routerLink]="['/orders', order.slug]" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-xs">
              View
            </button>
                        <button (click)="openUpdateStatusModal(order)" class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-xs">
              Status
            </button>
                        <button (click)="openDeleteConfirmModal(order)" class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded text-xs">
              Delete
            </button>
                    </td>
                </tr>
                <tr *ngIf="orders.length === 0 && !isLoading">
                    <td colspan="6" class="px-6 py-4 text-center">No orders found</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Update Status Modal -->
<div *ngIf="showStatusModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-10">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Update Order Status</h2>
        <p class="mb-4">Order: <span class="font-semibold">{{ selectedOrder?.slug }}</span></p>

        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2">Status</label>
            <select [(ngModel)]="newStatus" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        <option value="processing">Processing</option>
        <option value="shipped">Shipped</option>
        <option value="delivered">Delivered</option>
        <option value="cancelled">Cancelled</option>
      </select>
        </div>

        <div class="flex justify-end space-x-2">
            <button (click)="closeStatusModal()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded">
        Cancel
      </button>
            <button (click)="updateOrderStatus()" [disabled]="isUpdating" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
        {{ isUpdating ? 'Updating...' : 'Update' }}
      </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-10">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Delete Order</h2>
        <p class="mb-4">Are you sure you want to delete order <span class="font-semibold">{{ selectedOrder?.slug }}</span>?</p>
        <p class="text-red-600 mb-4">This action cannot be undone.</p>

        <div class="flex justify-end space-x-2">
            <button (click)="closeDeleteConfirmModal()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded">
        Cancel
      </button>
            <button (click)="deleteOrder()" [disabled]="isDeleting" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
        {{ isDeleting ? 'Deleting...' : 'Delete' }}
      </button>
        </div>
    </div>
</div>
