<div class="add-product-container">
  <h2>ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h2>
  
  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="product-form">
    
    <!-- ุงุณู ุงูููุชุฌ -->
    <mat-form-field appearance="outline"  class="full-width special-field" data-icon="๐" data-label="ุงุณู ุงูููุชุฌ">
      <mat-label>ุงุณู ุงูููุชุฌ</mat-label>
      <input matInput formControlName="name" placeholder="ุฃุฏุฎู ุงุณู ุงูููุชุฌ">
      <mat-error *ngIf="isFieldInvalid('name')">
        {{ getErrorMessage('name') }}
      </mat-error>
    </mat-form-field>

    <!-- ูุตู ุงูููุชุฌ -->
    <mat-form-field appearance="outline"  class="full-width special-field" data-icon="๐" data-label="ูุตู ุงูููุชุฌ">
      <mat-label>ูุตู ุงูููุชุฌ</mat-label>
      <textarea matInput formControlName="description" rows="4" placeholder="ุฃุฏุฎู ูุตู ุงูููุชุฌ"></textarea>
      <mat-error *ngIf="isFieldInvalid('description')">
        {{ getErrorMessage('description') }}
      </mat-error>
    </mat-form-field>

    <!-- ุงูุณุนุฑ ูุงูุณุนุฑ ุงููุฎูุถ -->
    <div class="price-row">
      <mat-form-field appearance="outline">
        <mat-label>ุงูุณุนุฑ</mat-label>
        <input matInput formControlName="price" type="number" placeholder="0.00">
        <span matSuffix>ุฌููู</span>
        <mat-error *ngIf="isFieldInvalid('price')">
          {{ getErrorMessage('price') }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>ุงูุณุนุฑ ุงููุฎูุถ (ุงุฎุชูุงุฑู)</mat-label>
        <input matInput formControlName="discounted_price" type="number" placeholder="0.00">
        <span matSuffix>ุฌููู</span>
      </mat-form-field>
    </div>

    <!-- ุงููููุฉ ูุงููุฆุฉ -->
    <div class="quantity-category-row">
      <mat-form-field appearance="outline">
        <mat-label>ุงููููุฉ</mat-label>
        <input matInput formControlName="quantity" type="number" min="1">
        <mat-error *ngIf="isFieldInvalid('quantity')">
          {{ getErrorMessage('quantity') }}
        </mat-error>
      </mat-form-field>
<!-- 
    <mat-form-field appearance="outline">
  <mat-label>ุงููุฆุฉ</mat-label>
  <mat-select formControlName="sub_category_id" placeholder="ุงุฎุชุฑ ุงููุฆุฉ">
 
    <mat-option *ngFor="let category of categories" [value]="category.id">
      {{ category.name }}
    </mat-option>
  </mat-select>
</mat-form-field> -->
<!-- ุงุฎุชูุงุฑ ุงููุณู ุงูุฑุฆูุณู -->
<mat-form-field appearance="outline">
  <mat-label>ุงููุฆุฉ ุงูุฑุฆูุณูุฉ</mat-label>
  <mat-select formControlName="category_slug" (selectionChange)="onCategoryChange($event.value)">
    <mat-option *ngFor="let cat of categories" [value]="cat.slug">
      {{ cat.name }}
    </mat-option>
  </mat-select>
</mat-form-field>

<!-- ุงุฎุชูุงุฑ ุงููุณู ุงููุฑุนู -->
<mat-form-field appearance="outline">
  <mat-label>ุงููุณู ุงููุฑุนู</mat-label>
  <mat-select formControlName="sub_category_id" (selectionChange)="onSubCategoryChange($event.value)">
    <mat-option *ngFor="let sub of subCategories" [value]="sub.id">
      {{ sub.name }} ({{ sub.slug }})
    </mat-option>
  </mat-select>
  <mat-error *ngIf="isFieldInvalid('sub_category_id')">
    {{ getErrorMessage('sub_category_id') }}
  </mat-error>
</mat-form-field>



    </div>

    <!-- ุงูุฃููุงู -->
<div class="colors-section" *ngIf="selectedCategoryFeatures.hasColors">
        <h3>ุงูุฃููุงู</h3>
      <div class="add-item-row">
        <mat-form-field appearance="outline" style="width: 70% !important; margin-right: 15%; margin-left: 12px;">
          <mat-label>ุฃุถู ููู</mat-label>
          <input matInput #colorInput placeholder="ูุซุงู: ุฃุญูุฑ, ุฃุฒุฑู">
        </mat-form-field>
        <button mat-raised-button type="button" color="primary" 
                (click)="addColor(colorInput)">
          ุฅุถุงูุฉ
        </button>
      </div>
      
      <div class="items-list" *ngIf="colors.length > 0">
        <div *ngFor="let color of colors.controls; let i = index" class="item-chip">
          <span>{{ color.value }}</span>
          <button mat-icon-button (click)="removeColor(i)" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- ุงูุฃุญุฌุงู -->
<div class="sizes-section" *ngIf="selectedCategoryFeatures.hasSizes">
      <h3>ุงูุฃุญุฌุงู</h3>
      <div class="add-item-row">
        <mat-form-field appearance="outline" style="width: 70% !important; margin-right: 15%; margin-left: 12px;">
          <mat-label>ุฃุถู ุญุฌู</mat-label>
          <input matInput #sizeInput placeholder="ูุซุงู: S, M, L, XL" >
        </mat-form-field>
        <button mat-raised-button type="button" color="primary" 
                (click)="addSize(sizeInput)">
          ุฅุถุงูุฉ
        </button>
      </div>
      
      <div class="items-list" *ngIf="sizes.length > 0">
        <div *ngFor="let size of sizes.controls; let i = index" class="item-chip">
          <span>{{ size.value }}</span>
          <button mat-icon-button (click)="removeSize(i)" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- ุงูุตูุฑ -->
    <div class="images-section">
      <h3>ุตูุฑ ุงูููุชุฌ</h3>
      
      <!-- ุฑูุน ุงูุตูุฑ -->
      <div class="upload-area">
        <input type="file" 
               #fileInput 
               (change)="onImageChange($event)" 
               multiple 
               accept="image/*" 
               style="display: none;">
        <button mat-raised-button type="button" color="accent" 
                (click)="fileInput.click()">
          ุงุฎุชุฑ ุตูุฑ (ูุชุนุฏุฏุฉ)
        </button>
        <p class="upload-hint">ููููู ุงุฎุชูุงุฑ ุนุฏุฉ ุตูุฑ ูู ููุณ ุงูููุช</p>
      </div>

      <!-- ุนุฑุถ ุงูุตูุฑ ุงููุฎุชุงุฑุฉ -->
      <div class="images-preview" *ngIf="imagePreviewUrls.length > 0">
        <h4>ุงูุตูุฑ ุงููุฎุชุงุฑุฉ ({{ images.length }})</h4>
        <div class="preview-grid">
          <div *ngFor="let url of imagePreviewUrls; let i = index" class="preview-item">
            <img [src]="url" [alt]="'ุตูุฑุฉ ' + (i + 1)">
            <div class="preview-overlay">
              <button mat-icon-button (click)="removeImage(i)" type="button" 
                      class="remove-btn">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <p class="image-name">{{ images[i]?.name }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
    <div class="form-actions">
      <button mat-raised-button 
              type="submit" 
              color="primary"
              [disabled]="isLoading || productForm.invalid || images.length === 0">
        <mat-icon *ngIf="!isLoading">save</mat-icon>
        <mat-icon *ngIf="isLoading" class="spinner">refresh</mat-icon>
        {{ isLoading ? 'ุฌุงุฑู ุงูุญูุธ...' : 'ุญูุธ ุงูููุชุฌ' }}
      </button>
      
      <button mat-button 
              type="button" 
              (click)="onCancel()"
              [disabled]="isLoading">
        ุฅูุบุงุก
      </button>
    </div>

  </form>
</div>


